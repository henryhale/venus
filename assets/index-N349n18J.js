var J=Object.defineProperty;var K=(s,t,e)=>t in s?J(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var h=(s,t,e)=>(K(s,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();const U="[x] Unable to generate 2D canvas rendering context",p=500,m=500,_=4,T=6,Z=5,b=0,P=100,Q=135*Math.PI/180,x=4,V=.05,tt=32,et=30,it=1,st=.5,nt=8,v=25,w=30,C=P/2,ot=.5,rt=.5,W=3,Y=50,G=10,ht="#009900",at="#00FF00";function X(s,t=p,e=m){s.save(),s.strokeStyle=at,s.fillStyle=ht;for(let i=0;i<t;i+=G)s.save(),s.lineWidth=i%Y==0?.5:.25,s.beginPath(),s.moveTo(i,0),s.lineTo(i,e),s.stroke(),s.restore();for(let i=0;i<e;i+=G)s.save(),s.lineWidth=i%Y==0?.5:.25,s.beginPath(),s.moveTo(0,i),s.lineTo(t,i),s.stroke(),s.restore();s.restore()}const q=()=>Date.now?Date.now():new Date().getTime(),lt=60;function ct(s,t,e=lt){let i,n;function o(){i&&r(),n=!0,d()}function r(){n=!1,i&&window.cancelAnimationFrame(i)}const l=1/e;let c,y=q(),a=0,u=0;function d(){if(!n)return r();for(c=q(),a=Math.min(1,(c-y)/1e3),u+=a;u>l;)u-=l,t(l);s(),y=c,i=window.requestAnimationFrame(d)}return i=window.requestAnimationFrame(d),{start:o,stop:r}}const dt="gray",ut=.75,z="round",A=class A{constructor(t,e){h(this,"name");h(this,"points");h(this,"color");h(this,"generator");h(this,"height");h(this,"unit");h(this,"limit");A.id++,this.name=t.name||"Graph"+A.id,this.color=t.color||dt,this.points=t.points||[],this.generator=e}get last(){return this.points.at(-1)}get first(){return this.points.at(0)}update(t){var i;let e=this.height;typeof this.generator=="function"&&(e=this.generator(this.height,t)??e),this.points.push({x:(((i=this.last)==null?void 0:i.x)??-this.unit)+this.unit,y:e}),this.points.length>=this.limit/this.unit&&(this.points.shift(),this.points.forEach(n=>n.x-=this.unit))}render(t,e){var i,n,o,r,l;t.save(),t.lineCap=z,t.lineJoin=z,t.lineWidth=ut,t.fillStyle=this.color,t.strokeStyle=this.color,t.beginPath(),t.moveTo(((i=this.first)==null?void 0:i.x)??0,((n=this.first)==null?void 0:n.y)??this.height);for(const c of this.points)t.lineTo(c.x,c.y);t.stroke(),t.beginPath(),t.arc(((o=this.last)==null?void 0:o.x)??0,((r=this.last)==null?void 0:r.y)??this.height,1.5*this.unit,0,2*Math.PI),t.closePath(),t.fill(),t.font="0.75rem sans-serif",t.fillStyle=this.color,t.fillText(`${this.name} : ${this.height-(((l=this.last)==null?void 0:l.y)??this.height)}`,this.limit,e,100),t.restore()}};h(A,"id",0);let L=A;function ft(s){const t=s.getContext("2d");t==null&&console.error(U);const e=p,i=m/5;s.height=i,s.width=e;let n=0;const o=[];function r(a={},u){if(typeof a=="object"&&a!=null){const d=new L(a,u);d.height=i,d.limit=.8*e,d.unit=2.5,o.push(d)}}function l(a=!1){t&&(t.clearRect(0,0,e,i),a&&X(t,e,i),o.forEach((u,d)=>{u.render(t,d*20+15)}),t.font="0.75rem serif",t.fillStyle="rgba(255,255,255,0.5)",t.fillText(" T = "+n.toFixed(3)+"s",0,20))}function c(a){n+=a,o.forEach(u=>u.update(a))}function y(){n=0,o.forEach(a=>{a.points=[]})}return{addPlot:r,render:l,update:c,reset:y}}function gt(s){return s>Math.PI?s-2*Math.PI:s<-Math.PI?2*Math.PI+s:s}const yt=Q/2;function O(s,t=yt){const[e,i]=[s-t,s+t].sort((n,o)=>n==o?1:n<o?-1:1);return gt(Math.random()*(i-e)+e)}function H(){return{x:Math.random()*p,y:Math.random()*m}}function B(s,t=0){let e=!0;return s.x<-t?s.x=p+t:s.x>p+t?s.x=-t:e=!1,s.y<-t?s.y=m+t:s.y>m+t?s.y=-t:e=!1,e}function pt(s,t){let e,i=1/0;return t.forEach(n=>{const o=n.x-s.x,r=n.y-s.y,l=Math.sqrt(o*o+r*r);l<i&&(i=l,e=n)}),e}class ${constructor(t,e){h(this,"x");h(this,"y");h(this,"angle");h(this,"velocity");h(this,"age");h(this,"size");h(this,"height");h(this,"skinColor");h(this,"hairColor");h(this,"opacity");h(this,"target");h(this,"energy");this.x=t,this.y=e,this.angle=0,this.velocity=0,this.age=0,this.size=_,this.height=T,this.opacity=1,this.energy=0}setTarget(t,e){if(!e||!t){const i=Math.random()*this.height+this.size,n=O(this.angle);t=this.x+i*Math.cos(n),e=this.y+i*Math.sin(n)}this.target={x:t,y:e},B(this.target)}updateBody(t){this.height>T?(this.height-=t*T,this.size+=.25*t*_):(this.height=1.5*T,this.size=_)}updateTarget(){if(!this.target)return this.setTarget();const t=this.target.x-this.x,e=this.target.y-this.y;Math.floor(Math.sqrt(t*t+e*e))!=0?this.angle=Math.atan2(e,t):this.target=void 0}move(t){const e=this.velocity*Math.cos(this.angle)*t,i=this.velocity*Math.sin(this.angle)*t;this.x=isNaN(e)?this.x:this.x+e,this.y=isNaN(i)?this.y:this.y+i,B(this)&&(this.target=void 0)}update(t){this.age+=t}render(t){t.save(),t.translate(this.x,this.y),t.rotate(this.angle),t.translate(-this.x,-this.y),t.fillStyle=this.skinColor,t.globalAlpha=this.opacity,t.shadowBlur=Z,t.shadowColor=this.hairColor,t.beginPath(),t.ellipse(this.x,this.y,this.height,this.size,0,0,2*Math.PI),t.closePath(),t.fill(),t.lineWidth=1,t.strokeStyle=this.hairColor,t.fillStyle="black",t.strokeStyle="white";const e=this.x+this.height*.75,i=this.y-this.size/1.5,n=this.y+this.size/1.5,o=this.size/3;t.beginPath(),t.arc(e,i,o,0,2*Math.PI),t.arc(e,n,o,0,2*Math.PI),t.closePath(),t.fill(),t.stroke(),t.setTransform(1,0,0,1,0,0),t.restore()}}class F extends ${constructor(e,i){super(e,i);h(this,"isEating");h(this,"count");h(this,"digestion");h(this,"hasReproduced",!1);this.skinColor="#FF1414",this.hairColor="#9c0000",this.velocity=tt,this.digestion=0,this.isEating=!1,this.count=0,this.energy=P}update(e){if(super.update(e),this.age>w){this.opacity=Math.min(1,w/(4*this.age));return}this.updateTarget(),this.isEating?(Math.floor(this.digestion)>=x?(this.isEating=!1,this.digestion=0):this.digestion+=e,this.size=1.1*_,this.height=1.1*T):this.energy>b&&(this.updateBody(e),this.move(e),this.energy=Math.max(this.energy-V,b))}hunt(e){const i=pt(this,e);if(i){const{x:n,y:o}=this,{x:r,y:l}=i,c=r-n,y=l-o,a=Math.sqrt(c*c+y*y);a<nt*this.height&&this.setTarget(r,l),a<this.size&&(e.splice(e.indexOf(i),1),this.target=void 0,this.isEating=!0,this.count++,this.energy=Math.min(this.energy+i.energy,P))}}reproduce(e){if(!this.hasReproduced&&Math.random()>Math.random()&&this.count&&this.energy>=C&&this.age>=rt*w){const i=Math.max(1,Math.floor(Math.random()*W)),n=new Array(i).fill(null).map(o=>{const r=new F(this.x,this.y);return r.energy=C,r.angle=O(this.angle),r.setTarget(),r});e.push(...n),this.hasReproduced=!0}}}class D extends ${constructor(e,i){super(e,i);h(this,"canMove");h(this,"hasReproduced",!1);this.skinColor="#19F824",this.hairColor="#20C728",this.velocity=et,this.energy=P,this.canMove=!1}update(e){if(super.update(e),this.age>v){this.opacity=Math.min(1,v/(4*this.age));return}this.canMove||Math.random()>st?this.energy&&(this.updateBody(e),this.updateTarget(),this.move(e),this.energy=Math.max(this.energy-V,b)):this.energy=Math.min(this.energy+it,P)}evade(e){let i=!1;e.forEach(n=>{const o=n.x-this.x,r=n.y-this.y;Math.sqrt(o*o+r*r)<=4*(n.size+this.size)&&(this.target=void 0,this.angle=n.angle,i=!0)}),this.canMove=i}reproduce(e){if(!this.hasReproduced&&this.energy>=C&&this.age>=ot*v){const i=Math.max(1,Math.floor(Math.random()*W)),n=new Array(i).fill(null).map(o=>{const r=new D(this.x,this.y);return r.energy=C,r.angle=O(this.angle),r.setTarget(),r});e.push(...n),this.hasReproduced=!0}}}const k=document.querySelector("canvas#world");k.width=p;k.height=m;const E=k.getContext("2d");E||console.error(U);const mt=15,Et=40,f=[],g=[];let I=!1;function Mt(s=Et,t=mt){g.splice(0);for(let e=0;e<s;e++){const{x:i,y:n}=H();g.push(new D(i,n))}f.splice(0);for(let e=0;e<t;e++){const{x:i,y:n}=H();f.push(new F(i,n))}}const Tt=document.querySelector("canvas#stats"),R=ft(Tt);R.addPlot({name:"Predators",color:"#FF1414"},s=>s-f.length);R.addPlot({name:"Prey",color:"#19F824"},s=>s-g.length);const N=ct(At,Pt);window.onbeforeunload=N.stop.bind(N);function At(){E&&(R.render(I),E.clearRect(0,0,p,m),I&&X(E),g.forEach(s=>s.render(E)),f.forEach(s=>s.render(E)))}function Pt(s){R.update(s);const t=g.filter(i=>i.age<1.25*v),e=f.filter(i=>i.age<1.25*w);t.forEach(i=>{i.update(s),i.evade(e),i.reproduce(t)}),e.forEach(i=>{i.update(s),i.hunt(t),i.reproduce(e)}),g.splice(0),f.splice(0),g.splice(0,0,...t),f.splice(0,0,...e),(!g.length||!f.length)&&M.click()}const S=document.querySelector("button#start"),M=document.querySelector("button#stop"),j=document.querySelector("button#reset"),Rt=document.querySelector("button#grid");Rt.addEventListener("click",()=>{I=!I});S.addEventListener("click",()=>{S.setAttribute("disabled","true"),M.removeAttribute("disabled"),N.start()});M.addEventListener("click",()=>{M.setAttribute("disabled","true"),S.removeAttribute("disabled"),N.stop()});j.addEventListener("click",()=>{M.click(),R.reset(),Mt(),S.click()});window.onload=()=>j.click();window.onbeforeunload=()=>M.click();
